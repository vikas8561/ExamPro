# Official Judge0 Deployment on Render - Complete Solution

Based on the official Judge0 repository analysis, here's the **correct deployment approach** that matches the official structure exactly.

## üéØ **What This Provides**

‚úÖ **Official Judge0 CE v1.13.1** - Latest stable version  
‚úÖ **All 60+ Languages** - Python, JavaScript, Java, C++, C, Go, Ruby, etc.  
‚úÖ **Production Ready** - Official Docker images and scripts  
‚úÖ **Scalable Architecture** - Rails API + Resque Workers  
‚úÖ **Secure Execution** - Isolate sandboxing  
‚úÖ **Full API Compatibility** - Matches official Judge0 exactly  

## üìã **Official Judge0 Architecture**

### **Components:**
1. **API Server** - Ruby on Rails application (Puma web server)
2. **Background Workers** - Resque-based job processing
3. **PostgreSQL** - Database for submissions and metadata
4. **Redis** - Job queue and caching
5. **Isolate Sandbox** - Secure code execution environment

### **Key Features:**
- **60+ Programming Languages** supported
- **Base64 encoding** for safe data storage
- **Resource limits** (CPU, memory, time)
- **Batch submissions** support
- **Webhook callbacks** for async processing
- **Authentication/Authorization** support
- **CORS enabled** for web applications

## üöÄ **Render Deployment Steps**

### **Step 1: Create Database (PostgreSQL)**

1. Go to Render Dashboard
2. Click **"New +"** ‚Üí **"PostgreSQL"**
3. Configure:
   - **Name**: `judge0-db`
   - **Plan**: Starter ($7/month) or Standard ($25/month)
   - **Region**: Oregon (or your preferred)
4. Click **"Create Database"**
5. **Note down** connection details

### **Step 2: Create Redis**

1. Click **"New +"** ‚Üí **"Redis"**
2. Configure:
   - **Name**: `judge0-redis`
   - **Plan**: Starter ($7/month) or Standard ($25/month)
   - **Region**: Same as database
3. Click **"Create Redis"**
4. **Note down** connection details

### **Step 3: Deploy API Service**

1. Click **"New +"** ‚Üí **"Web Service"**
2. Connect your GitHub repository
3. Configure:
   - **Name**: `judge0-api`
   - **Root Directory**: `judge0-render/api`
   - **Environment**: Docker
   - **Plan**: Starter ($7/month) or Standard ($25/month)
   - **Region**: Same as database
   - **Dockerfile Path**: `Dockerfile`

4. **Environment Variables**:
   ```bash
   # Rails Configuration
   RAILS_ENV=production
   RACK_ENV=production
   PORT=2358
   SECRET_KEY_BASE=<auto-generated>
   
   # Database Configuration
   POSTGRES_HOST=<from database>
   POSTGRES_PORT=<from database>
   POSTGRES_DB=<from database>
   POSTGRES_USER=<from database>
   POSTGRES_PASSWORD=<from database>
   
   # Redis Configuration
   REDIS_HOST=<from redis>
   REDIS_PORT=<from redis>
   REDIS_PASSWORD=<from redis>
   
   # Judge0 Configuration
   JUDGE0_VERSION=1.13.1
   ```

5. Click **"Create Web Service"**

### **Step 4: Deploy Worker Service**

1. Click **"New +"** ‚Üí **"Background Worker"**
2. Connect your GitHub repository
3. Configure:
   - **Name**: `judge0-worker`
   - **Root Directory**: `judge0-render/worker`
   - **Environment**: Docker
   - **Plan**: Starter ($7/month) or Standard ($25/month)
   - **Region**: Same as database
   - **Dockerfile Path**: `Dockerfile`

4. **Environment Variables** (same as API service)

5. Click **"Create Background Worker"**

## üìÅ **Required File Structure**

```
judge0-render/
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile          # Official Judge0 API
‚îÇ   ‚îú‚îÄ‚îÄ judge0.conf         # Configuration file
‚îÇ   ‚îî‚îÄ‚îÄ render.yaml         # Render deployment config
‚îî‚îÄ‚îÄ worker/
    ‚îú‚îÄ‚îÄ Dockerfile          # Official Judge0 Worker
    ‚îú‚îÄ‚îÄ judge0.conf         # Configuration file
    ‚îî‚îÄ‚îÄ render.yaml         # Render deployment config
```

## üîß **Configuration Details**

### **Dockerfiles**
- **API**: `FROM judge0/judge0:latest` with `/api/scripts/server`
- **Worker**: `FROM judge0/judge0:latest` with `/api/scripts/workers`

### **Configuration File (judge0.conf)**
```bash
# Judge0 Server Configuration
JUDGE0_TELEMETRY_ENABLE=false
RESTART_MAX_TRIES=10
MAINTENANCE_MODE=false
ENABLE_WAIT_RESULT=true
ENABLE_COMPILER_OPTIONS=true
ENABLE_COMMAND_LINE_ARGUMENTS=true
ENABLE_SUBMISSION_DELETE=false
ENABLE_BATCHED_SUBMISSIONS=true
MAX_SUBMISSION_BATCH_SIZE=20
ENABLE_CALLBACKS=true
CALLBACKS_MAX_TRIES=3
CALLBACKS_TIMEOUT=5
ENABLE_ADDITIONAL_FILES=true
SUBMISSION_CACHE_DURATION=1
USE_DOCS_AS_HOMEPAGE=false
DISABLE_IMPLICIT_BASE64_ENCODING=false

# Judge0 Workers Configuration
INTERVAL=0.1
COUNT=4
MAX_QUEUE_SIZE=100

# Judge0 Server Access Configuration
ALLOW_ORIGIN=
DISALLOW_ORIGIN=
ALLOW_IP=
DISALLOW_IP=

# Judge0 Authentication Configuration
AUTHN_HEADER=X-Auth-Token
AUTHN_TOKEN=

# Judge0 Authorization Configuration
AUTHZ_HEADER=X-Auth-User
AUTHZ_TOKEN=

# Redis Configuration
REDIS_HOST=${REDIS_HOST}
REDIS_PORT=${REDIS_PORT}
REDIS_PASSWORD=${REDIS_PASSWORD}
RESQUE_NAMESPACE=

# PostgreSQL Configuration
POSTGRES_HOST=${POSTGRES_HOST}
POSTGRES_PORT=${POSTGRES_PORT}
POSTGRES_DB=${POSTGRES_DB}
POSTGRES_USER=${POSTGRES_USER}
POSTGRES_PASSWORD=${POSTGRES_PASSWORD}

# Submission Configuration
CPU_TIME_LIMIT=5
MAX_CPU_TIME_LIMIT=15
CPU_EXTRA_TIME=1
MAX_CPU_EXTRA_TIME=5
WALL_TIME_LIMIT=10
MAX_WALL_TIME_LIMIT=20
MEMORY_LIMIT=128000
MAX_MEMORY_LIMIT=512000
STACK_LIMIT=64000
MAX_STACK_LIMIT=128000
MAX_PROCESSES_AND_OR_THREADS=60
MAX_MAX_PROCESSES_AND_OR_THREADS=120
ENABLE_PER_PROCESS_AND_THREAD_TIME_LIMIT=false
ALLOW_ENABLE_PER_PROCESS_AND_THREAD_TIME_LIMIT=true
ENABLE_PER_PROCESS_AND_THREAD_MEMORY_LIMIT=false
ALLOW_ENABLE_PER_PROCESS_AND_THREAD_MEMORY_LIMIT=true
MAX_FILE_SIZE=1024
MAX_MAX_FILE_SIZE=4096
NUMBER_OF_RUNS=1
MAX_NUMBER_OF_RUNS=20
REDIRECT_STDERR_TO_STDOUT=false
MAX_EXTRACT_SIZE=10240
ALLOW_ENABLE_NETWORK=true
ENABLE_NETWORK=false

# Rails Configuration
RAILS_ENV=production
RAILS_MAX_THREADS=4
RAILS_SERVER_PROCESSES=2
SECRET_KEY_BASE=
```

## üìä **Scaling for 200+ Users**

### **Current Setup (Starter Plans)**
- **API**: 1 instance, 4 threads
- **Worker**: 4 concurrent workers
- **Database**: Shared connection pool
- **Redis**: Shared queue

### **For Higher Load (Standard Plans)**
- **API**: 1 instance, more threads
- **Worker**: More concurrent workers
- **Database**: Better performance
- **Redis**: Better performance

### **Multiple Workers for High Concurrency**
- Deploy additional worker services
- Each worker handles 50+ concurrent submissions
- Total capacity: 200+ simultaneous users

## üß™ **Testing Your Deployment**

### **1. Health Check**
```bash
curl https://your-api-url.onrender.com/
```

### **2. System Info**
```bash
curl https://your-api-url.onrender.com/system_info
```

### **3. Test Code Execution**
```bash
curl -X POST https://your-api-url.onrender.com/submissions \
  -H "Content-Type: application/json" \
  -d '{
    "source_code": "print(\"Hello World\")",
    "language_id": 71,
    "stdin": ""
  }'
```

### **4. Get Results**
```bash
curl https://your-api-url.onrender.com/submissions/{submission_id}
```

## üîó **Update Your Application**

Update your `Backend/services/judge0.js`:

```javascript
const JUDGE0_INSTANCES = [
  'https://your-judge0-api.onrender.com',  // Your new API URL
  'http://localhost:2358'  // Local fallback
];
```

## üí∞ **Cost Breakdown**

### **Monthly Costs (Starter Plans)**
- **Database**: $7 (PostgreSQL Starter)
- **Redis**: $7 (Redis Starter)  
- **API Service**: $7 (Web Service Starter)
- **Worker Service**: $7 (Background Worker Starter)
- **Total**: ~$28/month

### **Monthly Costs (Standard Plans)**
- **Database**: $25 (PostgreSQL Standard)
- **Redis**: $25 (Redis Standard)  
- **API Service**: $25 (Web Service Standard)
- **Worker Service**: $25 (Background Worker Standard)
- **Total**: ~$100/month

### **Free Tier Alternative**
- Use **Render's free tier** (limited hours)
- **Database**: Free (with limitations)
- **Redis**: Free (with limitations)
- **Services**: Free (750 hours/month)

## üõ†Ô∏è **Troubleshooting**

### **Common Issues**

1. **Build Failures**:
   - Check Dockerfile paths
   - Verify configuration files
   - Ensure environment variables are set

2. **Connection Errors**:
   - Verify database/Redis connectivity
   - Check environment variables
   - Ensure services are running

3. **Performance Issues**:
   - Upgrade to higher plans
   - Add more worker instances
   - Monitor resource usage

### **Logs**
- **API Logs**: Render dashboard ‚Üí API service ‚Üí Logs
- **Worker Logs**: Render dashboard ‚Üí Worker service ‚Üí Logs

## üéâ **Benefits of Official Deployment**

‚úÖ **Reliability**: Official Judge0 repository  
‚úÖ **Security**: Official isolate sandboxing  
‚úÖ **Performance**: Optimized for production  
‚úÖ **Support**: Official documentation  
‚úÖ **Updates**: Easy to update to new versions  
‚úÖ **Languages**: Full 60+ language support  
‚úÖ **API Compatibility**: Matches official Judge0 exactly  
‚úÖ **Scalability**: Production-ready architecture  

## üìö **API Endpoints**

### **Core Endpoints**
- `GET /` - Homepage/Documentation
- `POST /submissions` - Create submission
- `GET /submissions/{token}` - Get submission result
- `GET /languages` - List supported languages
- `GET /statuses` - List execution statuses
- `GET /system_info` - System information

### **Batch Operations**
- `POST /submissions/batch` - Create multiple submissions
- `GET /submissions/batch` - Get multiple submission results

### **Authentication**
- `POST /authenticate` - Authenticate user
- `POST /authorize` - Authorize user

## üöÄ **Next Steps**

1. **Deploy** following this guide
2. **Test** with your application
3. **Monitor** performance and logs
4. **Scale** as needed for your users
5. **Update** your application's Judge0 URL

Your Judge0 instance will be production-ready with full language support for all 200+ students, using the exact same architecture as the official Judge0 repository! üéâ
